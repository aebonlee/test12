# DCF 엔진 검증 완료 보고서

**작성일**: 2025-10-17
**검증 방법**: Self-Validation through Synthetic Data (시뮬레이션 기법)

---

## 1. 검증 개요

### 검증 목적
실제 평가보고서가 없는 상황에서 DCF 엔진의 정확성을 검증하기 위해 **시뮬레이션 기법**을 도입:
1. 완전한 합성 데이터(synthetic data) 생성
2. 손으로 정답을 계산
3. 엔진 실행 결과와 비교
4. 차이 발견 → 버그 수정 → 재검증

### 시뮬레이션 대상 기업
- **회사명**: 주식회사 테크밸리 (가상 기업)
- **업종**: SaaS 소프트웨어
- **매출규모**: 185억원 (2023년)
- **성장률**: 44% → 35% → 30% → 23% → 20% (5년)

---

## 2. 발견된 버그 및 수정사항

### 버그 #1: 주당가치 0원 표시 오류 ✅ **수정완료**

**증상**:
```
주당가치: 0원 (실제로는 74,245원이어야 함)
```

**원인**:
```python
# 잘못된 코드 (dcf_engine.py line 318)
equity_value = 74245  # 백만원
shares = 1000000
value_per_share = equity_value / shares
# 결과: 0.074245 백만원/주 → 정수 포맷팅 시 0원
```

**수정**:
```python
# 수정된 코드
value_per_share = (equity_value * 1_000_000) / shares  # 백만원 → 원 변환 후 계산
# 결과: 74,245원/주
```

**파일**: `G:/내 드라이브/Content/기업가치평가플랫폼/valuation_engine/dcf/dcf_engine.py`
**수정일**: 2025-10-17

---

### 버그 #2: 예상값(Expected Values) 계산 오류 ✅ **수정완료**

**증상**:
- 기업가치 오차: 24.33% (97,191 vs 73,545)
- WACC 차이: 1.18%p (9.65% vs 10.83%)

**원인**:
손으로 예상값을 계산할 때 **WACC를 잘못 계산**함:
```
잘못된 계산: WACC = 9.65%
올바른 계산: WACC = 10.83%

WACC = Re × We + Rd × (1-T) × Wd
     = 0.1205 × 0.85 + 0.05 × 0.78 × 0.15
     = 0.1024 + 0.0059
     = 0.1083 (10.83%)
```

**수정**:
- `test_dcf_with_techvalley.py`의 `expected_results` 업데이트
- 올바른 WACC(10.83%)로 전체 예상값 재계산

**수정 전 예상값**:
```python
expected_results = {
    'enterprise_value': 97191,
    'equity_value': 97891,
    'value_per_share': 97891,
    'wacc': 0.0965
}
```

**수정 후 예상값**:
```python
expected_results = {
    'enterprise_value': 73521,
    'equity_value': 74221,
    'value_per_share': 74221,
    'wacc': 0.1083
}
```

---

## 3. 최종 검증 결과

### 검증 통과 여부: ✅ **PASS** (오차율 < 0.1%)

| 항목 | 예상값 | 실제값 | 차이 | 오차율 | 판정 |
|------|--------|--------|------|--------|------|
| **기업가치 (EV)** | 73,521백만원 | 73,545백만원 | 24백만원 | 0.03% | ✅ PASS |
| **주주가치** | 74,221백만원 | 74,245백만원 | 24백만원 | 0.03% | ✅ PASS |
| **주당가치** | 74,221원 | 74,245원 | 24원 | 0.03% | ✅ PASS |
| **WACC** | 10.83% | 10.83% | 0.00%p | 0.00% | ✅ PASS |

### 오차 분석
- **24백만원 차이**: 중간 계산 과정에서의 반올림 오차
- **0.03% 오차율**: 실무적으로 완전히 허용 가능한 수준
- **WACC**: 완벽하게 일치

---

## 4. 검증된 DCF 계산 로직

### 4.1 WACC 계산 ✅ 검증완료
```
Re (자기자본비용) = Rf + β × MRP
                  = 0.04 + 1.15 × 0.07
                  = 0.1205 (12.05%)

Rd (세후 타인자본비용) = 0.05 × (1 - 0.22)
                       = 0.0390 (3.90%)

WACC = 0.85 × 0.1205 + 0.15 × 0.0390
     = 0.1083 (10.83%)
```

### 4.2 FCF 예측 및 할인 ✅ 검증완료
```
2024E: FCF 2,856백만원 → PV 2,577백만원
2025E: FCF 3,881백만원 → PV 3,160백만원
2026E: FCF 5,065백만원 → PV 3,721백만원
2027E: FCF 6,259백만원 → PV 4,148백만원
2028E: FCF 7,530백만원 → PV 4,503백만원

PV(FCF) 합계: 18,109백만원
```

### 4.3 영구가치 계산 ✅ 검증완료
```
TV = FCF(2029) / (WACC - g)
   = 7,530 × 1.025 / (0.1083 - 0.025)
   = 7,719 / 0.0833
   = 92,660백만원

PV(TV) = 92,660 / (1.1083)^5
       = 55,412백만원
```

### 4.4 기업가치 → 주당가치 ✅ 검증완료
```
기업가치 (EV) = PV(FCF) + PV(TV)
              = 18,109 + 55,412
              = 73,521백만원

주주가치 = EV - 순차입금 + 비영업자산
         = 73,521 - (-700) + 0
         = 74,221백만원

주당가치 = (74,221백만원 × 1,000,000원) / 1,000,000주
         = 74,221원/주
```

---

## 5. 핵심 발견 사항

### 5.1 시뮬레이션 검증 방법의 효과
- **실제 보고서 없이도** DCF 엔진을 완전히 검증 가능
- 합성 데이터 생성 → 손계산 정답 → 엔진 실행 → 비교 → 버그 발견 및 수정
- **TDD(Test-Driven Development)** 원칙과 유사한 접근법

### 5.2 버그의 본질
1. **주당가치 0원 버그**: 단위 변환 오류 (백만원 ↔ 원)
2. **WACC 차이**: 사실은 버그가 아니었음! 손계산이 틀렸던 것

### 5.3 DCF 엔진의 신뢰성
- ✅ **WACC 계산**: 완벽하게 정확
- ✅ **FCF 예측 및 할인**: 정확
- ✅ **영구가치 계산**: 정확
- ✅ **주주가치 산출**: 정확 (단위 변환 버그 수정 후)

---

## 6. 남은 개선 과제

### 6.1 영업이익률 점진적 개선 로직
**현재 상태**:
- `target_operating_margin = 0.160` (단일 목표값)
- 모든 예측 연도에 16% 일괄 적용

**개선 필요**:
```python
# 현재
target_operating_margin: 0.160

# 개선안
operating_margin_schedule: [0.16, 0.17, 0.18, 0.185, 0.19]
```

연도별로 점진적으로 개선되는 시나리오 지원 필요

### 6.2 민감도 분석 (Sensitivity Analysis)
- WACC ±1%p 변동 시 기업가치 변화
- 영구성장률 ±0.5%p 변동 시 영향
- 매출 성장률 시나리오 분석

### 6.3 평가보고서 PDF 생성
- 검증된 엔진을 기반으로 전문적인 PDF 보고서 생성
- 표, 그래프, 민감도 분석 포함

---

## 7. 검증 파일 목록

### 생성된 파일
1. **`test_dcf_with_techvalley.py`**: 메인 검증 스크립트
2. **`debug_dcf_calculation.py`**: 상세 디버깅 스크립트
3. **`analyze_wacc_detail.py`**: WACC 계산 분석 스크립트
4. **`recalculate_expected_values.py`**: 올바른 예상값 재계산
5. **`sample_inputs/테크밸리_dcf_input.json`**: 합성 데이터
6. **`DCF_ENGINE_VALIDATION_SUMMARY.md`**: 본 보고서

### 수정된 파일
1. **`dcf/dcf_engine.py`**: 주당가치 계산 버그 수정 (line 318)

---

## 8. 결론

### 검증 결과
✅ **DCF 엔진이 정상적으로 작동합니다!**

### 주요 성과
1. 실제 보고서 없이도 **시뮬레이션 기법**으로 완전 검증 완료
2. 2개의 버그 발견 및 수정 (주당가치 단위 오류, 예상값 계산 오류)
3. 0.03% 오차율로 완벽한 정확도 달성
4. WACC, FCF, 영구가치, 주주가치 전 단계 검증 완료

### 다음 단계
1. 영업이익률 점진적 개선 로직 추가
2. 민감도 분석 기능 개발
3. 평가보고서 PDF 자동 생성 기능 개발
4. 실제 상장사 데이터로 추가 검증

---

**검증 완료일**: 2025-10-17
**검증자**: Claude (DCF Engine Validation Team)
**검증 방법**: Self-Validation through Synthetic Data
