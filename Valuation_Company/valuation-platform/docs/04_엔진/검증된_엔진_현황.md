# 검증된 평가 엔진 현황

> 작성일: 2026-01-19
> 상태: 확정
> 원본 위치: `C:\ValueLink\기업가치평가플랫폼\valuation_engine\`
> 비고: 임시 구조 (추후 표준 디렉토리 구조로 변경 예정)

---

## 엔진 요약

| # | 평가법 | 엔진 파일 | 라인 수 | 상태 |
|---|--------|----------|--------|------|
| 1 | DCF평가법 | `dcf_engine.py` | 505 | ✅ 검증완료 |
| 2 | 상대가치평가법 | `relative_engine.py` | 488 | ✅ 검증완료 |
| 3 | 본질가치평가법 | `cml_engine.py` → 명칭변경 | 258 | ✅ 검증완료 |
| 4 | 자산가치평가법 | `asset_engine.py` | 498 | ✅ 검증완료 |
| 5 | 상증세법평가법 | `itl_engine.py` | 380 | ✅ 검증완료 |
| + | 공통 라이브러리 | `financial_math.py` | 443 | ✅ 검증완료 |

**총 라인 수**: 약 2,572 lines

---

## 1. DCF평가법 엔진 (`dcf_engine.py`)

### 주요 기능

- 과거 재무제표 정규화 (일회성 손익 제거)
- 재무제표 예측 (5년)
- WACC 계산 (CAPM 기반)
- FCF 현재가치 할인
- 영구가치 계산 (Gordon Growth Model)
- 기업가치/주당가치 산출

### 핵심 메서드

```python
class DCFEngine:
    def normalize_financials(raw_financials)    # 재무제표 정규화
    def project_financials(base, assumptions)   # 재무 예측
    def calculate_wacc_detailed(wacc_inputs)    # WACC 계산
    def discount_cash_flows(fcf, wacc)          # FCF 할인
    def calculate_terminal_value_detailed(...)  # 영구가치
    def calculate_equity_value(...)             # 주주가치
    def run_valuation(inputs)                   # 전체 실행
```

### 참조 문헌

- KPMG "New Valuation Era" DCF Methodology
- 삼일PwC "M&A ESSENCE 2020" Chapter 3

---

## 2. 상대가치평가법 엔진 (`relative_engine.py`)

### 주요 기능

- PER 평가 (성장률 조정)
- PBR 평가 (ROE 조정)
- PSR 평가 (적자 기업용)
- EV/EBITDA 평가 (M&A 표준)
- IQR 이상치 제거
- 가중평균 통합

### 가중치 기본값

| 방법 | 가중치 |
|------|--------|
| PER | 40% |
| EV/EBITDA | 30% |
| PBR | 20% |
| PSR | 10% |

### 핵심 메서드

```python
class RelativeValuationEngine:
    def calculate_per_valuation(...)      # PER 평가
    def calculate_pbr_valuation(...)      # PBR 평가
    def calculate_psr_valuation(...)      # PSR 평가
    def calculate_ev_ebitda_valuation()   # EV/EBITDA 평가
    def _remove_outliers(data)            # IQR 이상치 제거
    def integrate_results(results)        # 통합
    def run_valuation(company, comps)     # 전체 실행
```

---

## 3. 본질가치평가법 엔진 (`cml_engine.py` → `intrinsic_value_engine.py`)

### 주요 기능

- 본질가치 계산: `(자산가치 × 1 + 수익가치 × 1.5) ÷ 2.5`
- 수익가치 방법1: 평균순이익 × 10
- 수익가치 방법2: DCF 결과 사용
- 주당가치 계산

### 핵심 공식

```
본질가치 = (자산가치 × 1 + 수익가치 × 1.5) ÷ 2.5
         = 자산가치 × 40% + 수익가치 × 60%
```

### 핵심 메서드

```python
class CapitalMarketLawEngine:  # → IntrinsicValueEngine
    def run_valuation(asset_value, income_value, purpose)
    def calculate_income_value_method1(net_income_3yr_avg)
    def calculate_income_value_method2(dcf_value)
    def calculate_value_per_share(cml_value, shares)
    def generate_full_report(...)
```

### 명칭 변경 필요

| 현재 | 변경 후 |
|------|--------|
| `CapitalMarketLawEngine` | `IntrinsicValueEngine` |
| `cml_value` | `intrinsic_value` |
| "자본시장법 평가" | "본질가치 평가" |

---

## 4. 자산가치평가법 엔진 (`asset_engine.py`)

### 주요 기능

- 유동자산 평가 (현금, 채권, 재고)
- 유형자산 평가 (토지, 건물, 기계) - 감정평가 반영
- 무형자산 평가 (영업권, 특허)
- 투자자산 평가 (상장/비상장 주식)
- 부채 공정가치 (우발부채 포함)
- NAV(순자산가치) 산출

### 핵심 메서드

```python
class AssetValuationEngine:
    def run_valuation(balance_sheet, fair_value_data)
    def _value_assets(...)
    def _value_current_assets(...)    # 유동자산
    def _value_fixed_assets(...)      # 유형자산
    def _value_intangible_assets(...) # 무형자산
    def _value_investment_assets(...) # 투자자산
    def _value_liabilities(...)       # 부채
```

---

## 5. 상증세법평가법 엔진 (`itl_engine.py`)

### 주요 기능

- 상증세법 평가: `(순손익가치 × 3 + 순자산가치 × 2) ÷ 5`
- 지배주주 할증 (+20%)
- 소액주주 할인
- 유동성 할인 (비상장)
- 주주 유형 자동 판단

### 핵심 공식

```
상증세법 평가액 = (순손익가치 × 3 + 순자산가치 × 2) ÷ 5
              = 순손익가치 × 60% + 순자산가치 × 40%
```

### 핵심 메서드

```python
class InheritanceTaxLawEngine:
    def run_valuation(net_income_3yr, net_assets, ...)
    def calculate_value_per_share(itl_value, shares)
    def determine_shareholder_type(ownership_ratio)
    def generate_full_report(...)
```

---

## 6. 공통 라이브러리 (`financial_math.py`)

### FinancialCalculator 클래스

| 메서드 | 설명 |
|--------|------|
| `present_value(cash_flows, rate)` | 현재가치 계산 |
| `future_value(pv, growth, periods)` | 미래가치 계산 |
| `wacc(rf, beta, mrp, cod, dr, tax)` | WACC 계산 |
| `terminal_value(fcf, g, wacc)` | 영구가치 (Gordon) |
| `pv_terminal_value(tv, wacc, n)` | TV 현재가치 |
| `irr(cash_flows, investment)` | IRR 계산 |
| `cagr(begin, end, periods)` | 연평균성장률 |
| `perpetuity(cf, rate)` | 영구연금 |
| `growing_perpetuity(cf, rate, g)` | 성장 영구연금 |

### ValidationLibrary 클래스

| 메서드 | 설명 |
|--------|------|
| `validate_balance_sheet(...)` | 대차대조표 균형 검증 |
| `validate_wacc_components(...)` | WACC 구성요소 검증 |
| `sanity_check_terminal_value_ratio(...)` | TV 비중 검증 (50~80%) |

---

## 플랫폼 적용 계획

```
원본: C:\ValueLink\기업가치평가플랫폼\valuation_engine\
                        ↓
                    복사 + 명칭 변경
                        ↓
적용: C:\ValueLink\Valuation_Company\valuation-platform\backend\app\services\valuation_engine\
```

### 변경 작업

1. 폴더 복사
2. `capital_market_law/` → `intrinsic/` 명칭 변경
3. 클래스/변수명 변경
4. import 경로 수정
5. 테스트 실행

---

*이 문서는 임시 구조입니다. 추후 표준 디렉토리 구조에 따라 재배치될 예정입니다.*
