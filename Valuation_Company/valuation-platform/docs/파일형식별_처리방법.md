# 파일 형식별 처리 방법

> 기업가치평가 플랫폼 - 업로드 파일 처리 가이드

---

## 파일 형식별 처리 방법 (최종)

| 형식 | 확장자 | Claude | OpenAI | Gemini | 처리 방법 | 허용 |
|------|--------|:------:|:------:|:------:|-----------|:----:|
| PDF | .pdf | ✅ | ✅ | ✅ | Claude Read 도구 | ✅ |
| JPEG 이미지 | .jpg, .jpeg | ✅ | ✅ | ✅ | Claude 멀티모달 | ✅ |
| PNG 이미지 | .png | ✅ | ✅ | ✅ | Claude 멀티모달 | ✅ |
| 텍스트 | .txt | ✅ | ✅ | ✅ | Claude Read 도구 | ✅ |
| CSV | .csv | ✅ | ✅ | ✅ | Claude Read 도구 | ✅ |
| JSON | .json | ✅ | ✅ | ✅ | Claude Read 도구 | ✅ |
| XML | .xml | ✅ | ✅ | ✅ | Claude Read 도구 | ✅ |
| 마크다운 | .md | ✅ | ✅ | ✅ | Claude Read 도구 | ✅ |
| HTML | .html | ✅ | ✅ | ✅ | Claude Read 도구 | ✅ |
| 압축 파일 | .zip | ✅ | - | - | Claude Bash 도구 | ✅ |
| Word | .doc, .docx | ❌ | ✅ | ✅ | OpenAI 또는 Gemini | ✅ |
| Excel | .xls, .xlsx | ❌ | ✅ | ✅ | OpenAI 또는 Gemini | ✅ |
| PowerPoint | .ppt, .pptx | ❌ | ✅ | ✅ | OpenAI 또는 Gemini | ✅ |
| GIF 이미지 | .gif | ❌ | ✅ | ✅ | OpenAI 또는 Gemini | ✅ |
| WebP 이미지 | .webp | ❌ | ✅ | ✅ | OpenAI 또는 Gemini | ✅ |
| BMP 이미지 | .bmp | ❌ | ✅ | ✅ | OpenAI 또는 Gemini | ✅ |
| 한글 문서 | .hwp | ❌ | ❌ | ❌ | **PDF 변환 후 업로드** | ❌ |

---

## 요약

| 처리 주체 | 확장자 수 | 형식 |
|-----------|:---------:|------|
| **Claude** | 10개 | PDF, JPG, PNG, TXT, CSV, JSON, XML, MD, HTML, ZIP |
| **OpenAI / Gemini** | 9개 | DOC, DOCX, XLS, XLSX, PPT, PPTX, GIF, WEBP, BMP |
| **변환 필요** | 1개 | HWP → PDF 변환 안내 |

---

## 허용 확장자 목록 (코드용)

```javascript
const ALLOWED_EXTENSIONS = {
  // Claude 처리 (10개)
  claude: ['.pdf', '.jpg', '.jpeg', '.png', '.txt', '.csv', '.json', '.xml', '.md', '.html', '.zip'],

  // OpenAI / Gemini 처리 (9개)
  external: ['.doc', '.docx', '.xls', '.xlsx', '.ppt', '.pptx', '.gif', '.webp', '.bmp'],

  // PDF 변환 필요 - 업로드 불가 (1개)
  convertRequired: ['.hwp']
};

const ALL_ALLOWED = [...ALLOWED_EXTENSIONS.claude, ...ALLOWED_EXTENSIONS.external];
// 총 19개 확장자 허용
```

---

## '기타' 항목 업로드 규칙

| 항목 | 규칙 |
|------|------|
| 파일 개수 | 최소 1개 ~ 최대 5개 |
| 파일당 용량 | 20MB 이하 |
| 총 용량 | 100MB 이내 |
| 필수 여부 | '기타' 선택 시 최소 1개 필수 |

### 파일명 자동 생성 규칙

```
[관리번호]_ETC[순번].[확장자]

예시:
SAMSU-2501191430-DC_ETC1.pdf
SAMSU-2501191430-DC_ETC2.jpg
SAMSU-2501191430-DC_ETC3.xlsx
```

---

## 업로드 UI 안내 문구

```
허용 형식: PDF, Word, Excel, PPT, 이미지(JPG, PNG, GIF), ZIP

⚠️ HWP 파일은 PDF로 변환하여 업로드해주세요
   (한글 → 파일 → PDF로 저장하기)
```

---

## 유효성 검사 코드

```javascript
const MAX_FILE_SIZE = 20 * 1024 * 1024;  // 20MB
const MAX_TOTAL_SIZE = 100 * 1024 * 1024; // 100MB
const MAX_OTHER_FILES = 5;

const ALLOWED_EXTENSIONS = [
  '.pdf', '.jpg', '.jpeg', '.png', '.txt', '.csv', '.json', '.xml', '.md', '.html', '.zip',
  '.doc', '.docx', '.xls', '.xlsx', '.ppt', '.pptx', '.gif', '.webp', '.bmp'
];

const CONVERT_REQUIRED = ['.hwp'];

const validateFile = (file) => {
  const ext = '.' + file.name.split('.').pop().toLowerCase();

  // HWP 파일 체크
  if (CONVERT_REQUIRED.includes(ext)) {
    return {
      valid: false,
      message: 'HWP 파일은 PDF로 변환하여 업로드해주세요'
    };
  }

  // 확장자 체크
  if (!ALLOWED_EXTENSIONS.includes(ext)) {
    return {
      valid: false,
      message: '지원하지 않는 파일 형식입니다'
    };
  }

  // 용량 체크
  if (file.size > MAX_FILE_SIZE) {
    return {
      valid: false,
      message: '파일 용량은 20MB를 초과할 수 없습니다'
    };
  }

  return { valid: true };
};
```

---

## DB 저장 구조

```sql
-- 첨부파일 테이블 (프로젝트와 1:N 관계)
CREATE TABLE project_attachments (
    id SERIAL PRIMARY KEY,
    project_id VARCHAR(20) REFERENCES projects(id),
    category VARCHAR(20),                 -- 'financial', 'business_plan', 'others' 등
    seq_no INT,                           -- 기타 항목 순번 (1~5)
    original_name VARCHAR(255),           -- 원본 파일명
    stored_name VARCHAR(255),             -- 저장 파일명 (관리번호_ETC1.pdf)
    file_size BIGINT,                     -- 바이트
    file_type VARCHAR(100),               -- MIME type
    description VARCHAR(100),             -- 자료 설명
    uploaded_at TIMESTAMP,
    uploaded_by VARCHAR(50)               -- 'customer' or 'accountant'
);
```

---

**문서 버전:** 1.0
**작성일:** 2025-01-19
**프로젝트:** 기업가치평가 플랫폼 (valuation.ai.kr)
