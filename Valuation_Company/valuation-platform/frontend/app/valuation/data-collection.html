<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë°ì´í„° ìˆ˜ì§‘ ì¤‘ | ValueLink</title>
    
    <!-- ëª¨ë°”ì¼ ìµœì í™” CSS -->
    <link rel="stylesheet" href="../styles/mobile-optimize.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --deep-blue: #1D4ED8;
            --deep-green: #166534;
            --text-primary: #111827;
            --text-secondary: #6B7280;
            --white: #FFFFFF;
            --border: #E5E7EB;
            --success: #10B981;
            --processing: #3B82F6;
        }

        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #F9FAFB;
            color: var(--text-primary);
        }

        /* Container */
        .container {
            display: flex;
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px;
            gap: 40px;
        }

        /* Main Content */
        .main-content {
            flex: 1;
        }

        .page-header {
            margin-bottom: 32px;
        }

        .page-title {
            font-size: 32px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .page-description {
            font-size: 16px;
            color: var(--text-secondary);
        }

        /* Project Info Card */
        .project-info-card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid var(--border);
        }

        .project-info-card h3 {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 16px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }

        .info-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .info-label {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .info-value {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .project-id {
            font-family: 'Consolas', 'Monaco', monospace;
            color: var(--deep-blue);
        }

        /* Progress Section */
        .progress-section {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid var(--border);
        }

        .progress-section h3 {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 20px;
        }

        .progress-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .current-task {
            font-size: 15px;
            font-weight: 600;
            color: var(--processing);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .progress-percentage {
            font-size: 24px;
            font-weight: 700;
            color: var(--deep-green);
        }

        .progress-bar-container {
            width: 100%;
            height: 12px;
            background: #E5E7EB;
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 24px;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--deep-green) 0%, #10B981 100%);
            border-radius: 6px;
            transition: width 0.5s ease;
            position: relative;
            overflow: hidden;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.3),
                transparent
            );
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Data Collection List */
        .data-collection-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .data-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            background: #F9FAFB;
            border: 2px solid var(--border);
            border-radius: 12px;
            transition: all 0.2s ease;
        }

        .data-item.completed {
            border-color: var(--success);
            background: #ECFDF5;
        }

        .data-item.processing {
            border-color: var(--processing);
            background: #EFF6FF;
        }

        .data-icon {
            font-size: 24px;
            flex-shrink: 0;
        }

        .data-info {
            flex: 1;
        }

        .data-name {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .data-status {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .data-status.completed {
            color: var(--success);
        }

        .data-status.processing {
            color: var(--processing);
        }

        .check-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            flex-shrink: 0;
        }

        .check-icon.completed {
            background: var(--success);
            color: white;
        }

        .check-icon.processing {
            background: var(--processing);
            color: white;
            animation: pulse 1.5s ease-in-out infinite;
        }

        .check-icon.pending {
            background: #E5E7EB;
            color: #9CA3AF;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 60px 20px;
        }

        .loading-spinner {
            width: 48px;
            height: 48px;
            border: 4px solid #E5E7EB;
            border-top-color: var(--deep-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 15px;
            color: var(--text-secondary);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }

        .empty-state-text {
            font-size: 16px;
            color: var(--text-secondary);
            margin-bottom: 24px;
        }

        .btn-primary {
            padding: 12px 24px;
            font-size: 15px;
            font-weight: 600;
            color: white;
            background: var(--deep-blue);
            border: none;
            border-radius: 10px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary:hover {
            background: #1E40AF;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .container {
                flex-direction: column;
            }

            .info-grid {
                grid-template-columns: 1fr;
            }

            .progress-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
        }
    </style>
</head>
<body>
    <!-- ì ‘ê·¼ ê¶Œí•œ í™•ì¸ -->
    <div id="access-denied" style="display:none;">
        <div style="text-align:center; padding:80px 20px; max-width:500px; margin:0 auto;">
            <div style="font-size:48px; margin-bottom:20px;">ğŸ”’</div>
            <h2 style="color:#1F2937; margin-bottom:12px;">ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤</h2>
            <p style="color:#6B7280; margin-bottom:24px;">ì´ í˜ì´ì§€ëŠ” ë‹´ë‹¹ íšŒê³„ì‚¬ ë° ê´€ë¦¬ìë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>í˜„ì¬ ì§„í–‰ ìƒíƒœëŠ” ì‚¬ì´ë“œë°”ì—ì„œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            <a href="../valuation.html" style="display:inline-block; padding:12px 24px; background:#166534; color:white; border-radius:8px; text-decoration:none; font-weight:600;">ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
        </div>
    </div>

    <script>
        // Supabase ì„¸ì…˜ ê¸°ë°˜ ì—­í•  ì²´í¬
        (function() {
            // 1ì°¨: localStorage ìºì‹œ í™•ì¸ (ë™ê¸°, ë¹ ë¦„)
            var role = localStorage.getItem('userRole') || 'customer';
            if (role === 'accountant' || role === 'admin') return; // í†µê³¼

            // 2ì°¨: ì¼ë‹¨ ì°¨ë‹¨ í‘œì‹œ í›„, Supabase ë¹„ë™ê¸° í™•ì¸
            document.getElementById('access-denied').style.display = 'block';
            document.addEventListener('DOMContentLoaded', function() {
                var header = document.getElementById('header-container');
                if (header) header.style.display = 'none';
                var container = document.querySelector('.container');
                if (container) container.style.display = 'none';

                // Supabase ì„¸ì…˜ ë¹„ë™ê¸° í™•ì¸
                var ADMIN_EMAILS = ['wksun999@gmail.com'];
                var script = document.createElement('script');
                script.type = 'module';
                script.textContent = `
                    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';
                    try {
                        const supabase = createClient(
                            'https://arxrfetgaitkgiiqabap.supabase.co',
                            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFyeHJmZXRnYWl0a2dpaXFhYmFwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg3ODk1OTgsImV4cCI6MjA4NDM2NTU5OH0.BTnuv0sYr2MGe1c-gk8PWCviwkFyIiymfKp5Jhzwbo0'
                        );
                        const { data: { session } } = await supabase.auth.getSession();
                        if (session && session.user) {
                            const email = session.user.email.toLowerCase();
                            const { data: userData } = await supabase
                                .from('users').select('role').eq('user_id', session.user.id).single();
                            const detectedRole = (userData && userData.role) ? userData.role
                                : (${JSON.stringify(['wksun999@gmail.com'])}.includes(email) ? 'admin' : 'customer');
                            if (detectedRole === 'admin' || detectedRole === 'accountant') {
                                localStorage.setItem('userRole', detectedRole);
                                localStorage.setItem('userEmail', email);
                                location.reload();
                            }
                        }
                    } catch(e) { console.warn('Supabase ì„¸ì…˜ í™•ì¸ ì‹¤íŒ¨:', e); }
                `;
                document.body.appendChild(script);
            });
        })();
    </script>

    <!-- í—¤ë” -->
    <div id="header-container"></div>

    <div class="container">
        <!-- ë©”ì¸ ì»¨í…ì¸  -->
        <main class="main-content">
            <div class="page-header">
                <h1 class="page-title">ë°ì´í„° ìˆ˜ì§‘ ì¤‘</h1>
                <p class="page-description">AIê°€ ì œì¶œí•˜ì‹  ìë£Œë¥¼ ìë™ìœ¼ë¡œ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p>
            </div>

            <!-- ë¡œë”© ìƒíƒœ -->
            <div id="loadingState" class="loading">
                <div class="loading-spinner"></div>
                <p class="loading-text">í”„ë¡œì íŠ¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>

            <!-- í”„ë¡œì íŠ¸ ì •ë³´ -->
            <div id="projectInfoCard" class="project-info-card" style="display: none;">
                <h3>í”„ë¡œì íŠ¸ ì •ë³´</h3>
                <div class="info-grid">
                    <div class="info-item">
                        <span class="info-label">í”„ë¡œì íŠ¸ ë²ˆí˜¸</span>
                        <span class="info-value project-id" id="projectIdDisplay">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">íšŒì‚¬ëª…</span>
                        <span class="info-value" id="companyNameDisplay">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">í‰ê°€ë²•</span>
                        <span class="info-value" id="methodDisplay">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">í‰ê°€ ê¸°ì¤€ì¼</span>
                        <span class="info-value" id="valuationDateDisplay">-</span>
                    </div>
                </div>
            </div>

            <!-- ì§„í–‰ ìƒí™© -->
            <div id="progressSection" class="progress-section" style="display: none;">
                <h3>ìˆ˜ì§‘ ì§„í–‰ ìƒí™©</h3>

                <div class="progress-header">
                    <div class="current-task" id="currentTask">
                        <span class="loading-spinner" style="width: 16px; height: 16px; border-width: 2px; margin: 0;"></span>
                        <span id="currentTaskText">ì¬ë¬´ì œí‘œ ë¶„ì„ ì¤‘...</span>
                    </div>
                    <div class="progress-percentage" id="progressPercentage">0%</div>
                </div>

                <div class="progress-bar-container">
                    <div class="progress-bar" id="progressBar" style="width: 0%"></div>
                </div>

                <div class="data-collection-list" id="dataCollectionList">
                    <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
                </div>
            </div>

            <!-- ë¹ˆ ìƒíƒœ -->
            <div id="emptyState" class="empty-state" style="display: none;">
                <div class="empty-state-icon">ğŸ“‹</div>
                <p class="empty-state-text">í˜„ì¬ ì§„í–‰ ì¤‘ì¸ ë°ì´í„° ìˆ˜ì§‘ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                <p style="color: #6B7280; font-size: 14px;">í”„ë¡œì íŠ¸ê°€ ì´ ë‹¨ê³„ì— ë„ë‹¬í•˜ë©´ ìë™ìœ¼ë¡œ ë°ì´í„° ìˆ˜ì§‘ì´ ì‹œì‘ë©ë‹ˆë‹¤.</p>
            </div>
        </main>

    </div>

    <!-- í—¤ë” ë¡œë“œ -->
    <script>
        fetch('../../components/header.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('header-container').innerHTML = data;
                const scripts = document.getElementById('header-container').querySelectorAll('script');
                scripts.forEach(script => {
                    const newScript = document.createElement('script');
                    if (script.src) {
                        newScript.src = script.src;
                    } else {
                        newScript.textContent = script.textContent;
                    }
                    document.body.appendChild(newScript);
                });
            })
            .catch(error => console.error('í—¤ë” ë¡œë“œ ì‹¤íŒ¨:', error));
    </script>

    <!-- í˜ì´ì§€ ìŠ¤í¬ë¦½íŠ¸ -->
    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';
        import { checkMethodStatus, METHOD_NAMES, STATUS } from '../../components/project-status-checker.js';

        // Supabase í´ë¼ì´ì–¸íŠ¸
        const SUPABASE_URL = 'https://arxrfetgaitkgiiqabap.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFyeHJmZXRnYWl0a2dpaXFhYmFwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg3ODk1OTgsImV4cCI6MjA4NDM2NTU5OH0.BTnuv0sYr2MGe1c-gk8PWCviwkFyIiymfKp5Jhzwbo0';
        const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

        // ë°ì´í„° ìˆ˜ì§‘ í•­ëª© ì •ì˜
        const DATA_COLLECTION_ITEMS = [
            { id: 'financial_statements', name: 'ì¬ë¬´ì œí‘œ ë¶„ì„', icon: 'ğŸ“Š' },
            { id: 'company_info', name: 'íšŒì‚¬ ì •ë³´ ì¶”ì¶œ', icon: 'ğŸ¢' },
            { id: 'market_data', name: 'ì‹œì¥ ë°ì´í„° ìˆ˜ì§‘', icon: 'ğŸ“ˆ' },
            { id: 'industry_analysis', name: 'ì‚°ì—… ë¶„ì„', icon: 'ğŸ”' },
            { id: 'valuation_data', name: 'í‰ê°€ ë°ì´í„° ìƒì„±', icon: 'ğŸ’°' }
        ];

        let currentProgress = 0;
        let currentItemIndex = 0;

        async function loadProject() {
            try {
                // URLì—ì„œ projectIdì™€ method ê°€ì ¸ì˜¤ê¸°
                const urlParams = new URLSearchParams(window.location.search);
                const projectId = urlParams.get('projectId');
                const method = urlParams.get('method');

                if (!projectId || !method) {
                    showEmptyState();
                    return;
                }

                // í”„ë¡œì íŠ¸ ì •ë³´ ì¡°íšŒ
                const { data: project, error } = await supabase
                    .from('projects')
                    .select('*')
                    .eq('project_id', projectId)
                    .single();

                if (error || !project) {
                    console.error('í”„ë¡œì íŠ¸ ì¡°íšŒ ì‹¤íŒ¨:', error);
                    showEmptyState();
                    return;
                }

                // í‰ê°€ë²• ìƒíƒœ í™•ì¸
                const methodStatus = await checkMethodStatus(projectId, method);

                // í”„ë¡œì íŠ¸ ì •ë³´ í‘œì‹œ
                displayProjectInfo(project, method);

                // ë°ì´í„° ìˆ˜ì§‘ ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘
                startDataCollection();

                // ë¡œë”© ìˆ¨ê¹€
                document.getElementById('loadingState').style.display = 'none';

            } catch (error) {
                console.error('ì˜¤ë¥˜ ë°œìƒ:', error);
                showEmptyState();
            }
        }

        function displayProjectInfo(project, method) {
            document.getElementById('projectIdDisplay').textContent = project.project_id;
            document.getElementById('companyNameDisplay').textContent =
                project.company_name || '-';
            document.getElementById('methodDisplay').textContent = METHOD_NAMES[method] || method;
            document.getElementById('valuationDateDisplay').textContent =
                project.valuation_date || '-';

            document.getElementById('projectInfoCard').style.display = 'block';
        }

        function startDataCollection() {
            // ë°ì´í„° í•­ëª© ë Œë”ë§
            renderDataItems();

            // ì§„í–‰ ìƒí™© ì„¹ì…˜ í‘œì‹œ
            document.getElementById('progressSection').style.display = 'block';

            // API í´ë§ ì‹œì‘
            const urlParams = new URLSearchParams(window.location.search);
            const projectId = urlParams.get('projectId');
            const method = urlParams.get('method');

            startPolling(projectId, method);
        }

        function renderDataItems() {
            const list = document.getElementById('dataCollectionList');
            list.innerHTML = '';

            DATA_COLLECTION_ITEMS.forEach((item, index) => {
                const dataItem = document.createElement('div');
                dataItem.className = 'data-item';
                dataItem.id = `data-item-${index}`;

                dataItem.innerHTML = `
                    <span class="data-icon">${item.icon}</span>
                    <div class="data-info">
                        <div class="data-name">${item.name}</div>
                        <div class="data-status" id="data-status-${index}">ëŒ€ê¸° ì¤‘</div>
                    </div>
                    <div class="check-icon pending" id="check-icon-${index}">
                        <span>â—‹</span>
                    </div>
                `;

                list.appendChild(dataItem);
            });
        }

        let pollInterval = null;

        async function pollProgress(projectId, method) {
            try {
                const response = await fetch(
                    `http://localhost:8000/api/v1/valuation/progress?project_id=${projectId}&method=${method}`
                );

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();

                // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
                updateProgress(data.progress);

                // current_stepì´ 5(ë°ì´í„° ìˆ˜ì§‘ ë‹¨ê³„)ì¼ ë•Œë§Œ í˜„ì¬ ì‘ì—… ì—…ë°ì´íŠ¸
                if (data.current_step === 5 && data.message) {
                    document.getElementById('currentTaskText').textContent = data.message;
                }

                // ì§„í–‰ë¥ ì— ë”°ë¼ ë°ì´í„° í•­ëª© ì‹œê°ì  ì—…ë°ì´íŠ¸
                updateDataItemsVisual(data.progress);

                // Step 6 ì´ìƒì´ë©´ í‰ê°€ ì§„í–‰ í˜ì´ì§€ë¡œ ì´ë™
                if (data.current_step >= 6) {
                    clearInterval(pollInterval);
                    onCollectionComplete(projectId, method);
                }

            } catch (error) {
                console.error('Progress polling error:', error);
                // ì—ëŸ¬ ë°œìƒ ì‹œ ì¬ì‹œë„ (ìµœëŒ€ 3íšŒ)
                if (!window.pollingRetryCount) {
                    window.pollingRetryCount = 0;
                }
                window.pollingRetryCount++;

                if (window.pollingRetryCount > 3) {
                    clearInterval(pollInterval);
                    showError('ë°ì´í„° ìˆ˜ì§‘ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
                }
            }
        }

        function startPolling(projectId, method) {
            // í˜ì´ì§€ ë¡œë“œ ì‹œ 1ë²ˆë§Œ í˜¸ì¶œ (Polling ì œê±°)
            // 24-48ì‹œê°„ ì†Œìš” ì‘ì—…ì´ë¯€ë¡œ ì‹¤ì‹œê°„ polling ë¶ˆí•„ìš”
            // ì´ë©”ì¼ ì•Œë¦¼ìœ¼ë¡œ ë‹¨ê³„ ì™„ë£Œ í†µì§€
            pollProgress(projectId, method);

            // âŒ 2ì´ˆ polling ì œê±° (24ì‹œê°„ ì‘ì—…ì— 43,200ë²ˆ ìš”ì²­ì€ ê³¼ë„í•¨)
            // pollInterval = setInterval(() => {
            //     pollProgress(projectId, method);
            // }, 2000);
        }

        function updateDataItemsVisual(percentage) {
            // ì§„í–‰ë¥ ì„ 5ê°œ í•­ëª©ì— ë¶„ì‚°
            const itemsCompleted = Math.floor((percentage / 100) * DATA_COLLECTION_ITEMS.length);
            const currentProcessingIndex = Math.min(itemsCompleted, DATA_COLLECTION_ITEMS.length - 1);

            DATA_COLLECTION_ITEMS.forEach((item, index) => {
                const dataItem = document.getElementById(`data-item-${index}`);
                const dataStatus = document.getElementById(`data-status-${index}`);
                const checkIcon = document.getElementById(`check-icon-${index}`);

                if (index < itemsCompleted) {
                    // ì™„ë£Œëœ í•­ëª©
                    dataItem.classList.remove('processing');
                    dataItem.classList.add('completed');
                    dataStatus.textContent = 'ì™„ë£Œ';
                    dataStatus.classList.remove('processing');
                    dataStatus.classList.add('completed');
                    checkIcon.classList.remove('pending', 'processing');
                    checkIcon.classList.add('completed');
                    checkIcon.innerHTML = '<span>âœ“</span>';
                } else if (index === currentProcessingIndex && percentage < 100) {
                    // í˜„ì¬ ì§„í–‰ ì¤‘ì¸ í•­ëª©
                    dataItem.classList.add('processing');
                    dataStatus.textContent = 'ë¶„ì„ ì¤‘...';
                    dataStatus.classList.add('processing');
                    checkIcon.classList.remove('pending');
                    checkIcon.classList.add('processing');
                    checkIcon.innerHTML = '<span>â—</span>';
                } else {
                    // ëŒ€ê¸° ì¤‘ì¸ í•­ëª©
                    dataItem.classList.remove('processing', 'completed');
                    dataStatus.textContent = 'ëŒ€ê¸° ì¤‘';
                    dataStatus.classList.remove('processing', 'completed');
                    checkIcon.classList.remove('processing', 'completed');
                    checkIcon.classList.add('pending');
                    checkIcon.innerHTML = '<span>â—‹</span>';
                }
            });
        }

        function updateProgress(percentage) {
            document.getElementById('progressPercentage').textContent = `${percentage}%`;
            document.getElementById('progressBar').style.width = `${percentage}%`;
        }

        function onCollectionComplete(projectId, method) {
            // ì™„ë£Œ ë©”ì‹œì§€
            document.getElementById('currentTaskText').textContent = 'ë°ì´í„° ìˆ˜ì§‘ ì™„ë£Œ!';
            const spinnerEl = document.querySelector('.current-task .loading-spinner');
            if (spinnerEl) {
                spinnerEl.style.display = 'none';
            }

            // 2ì´ˆ í›„ í‰ê°€ ì§„í–‰ í˜ì´ì§€ë¡œ ì´ë™
            setTimeout(() => {
                window.location.href = `./evaluation-progress.html?projectId=${projectId}&method=${method}`;
            }, 2000);
        }

        function showError(message) {
            const progressSection = document.getElementById('progressSection');
            const errorDiv = document.createElement('div');
            errorDiv.style.cssText = 'padding: 16px; background: #FEE2E2; color: #991B1B; border-radius: 12px; margin-top: 16px; text-align: center;';
            errorDiv.textContent = message;
            progressSection.appendChild(errorDiv);
        }

        function showEmptyState() {
            document.getElementById('loadingState').style.display = 'none';
            document.getElementById('projectInfoCard').style.display = 'none';
            document.getElementById('progressSection').style.display = 'none';
            document.getElementById('emptyState').style.display = 'block';
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
        loadProject();
    </script>
</body>
</html>
