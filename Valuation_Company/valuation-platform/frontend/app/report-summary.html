<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í‰ê°€ë³´ê³ ì„œ ê°œìš” | ValueLink</title>
    
    <!-- ëª¨ë°”ì¼ ìµœì í™” CSS -->
    <link rel="stylesheet" href="styles/mobile-optimize.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --deep-blue: #1D4ED8;
            --deep-green: #166534;
            --text-primary: #111827;
            --text-secondary: #6B7280;
            --white: #FFFFFF;
            --border: #E5E7EB;
        }

        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #F9FAFB;
            color: var(--text-primary);
            line-height: 1.6;
        }

        /* Container */
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        /* Back Button */
        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: white;
            border: 2px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            text-decoration: none;
            font-weight: 600;
            margin-bottom: 24px;
            transition: all 0.2s ease;
        }

        .back-button:hover {
            border-color: var(--deep-green);
            color: var(--deep-green);
        }

        /* Company Header */
        .company-header {
            background: white;
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .company-title {
            font-size: 32px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 16px;
        }

        .company-meta {
            display: flex;
            gap: 24px;
            flex-wrap: wrap;
            margin-bottom: 16px;
        }

        .meta-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .meta-label {
            font-size: 13px;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .meta-value {
            font-size: 15px;
            color: var(--text-primary);
            font-weight: 700;
        }

        .valuation-badge {
            display: inline-block;
            padding: 12px 20px;
            background: #DCFCE7;
            color: var(--deep-green);
            border-radius: 8px;
            font-size: 18px;
            font-weight: 700;
            margin-top: 8px;
        }

        .external-link {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 10px 16px;
            background: var(--deep-blue);
            color: white;
            border-radius: 8px;
            text-decoration: none;
            font-size: 14px;
            font-weight: 600;
            margin-top: 16px;
            transition: all 0.2s ease;
        }

        .external-link:hover {
            background: #1E40AF;
        }

        /* Report Section */
        .report-section {
            background: white;
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .section-title {
            font-size: 22px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--border);
        }

        .section-title-icon {
            margin-right: 8px;
        }

        .section-content {
            font-size: 15px;
            line-height: 1.8;
            color: var(--text-secondary);
            white-space: pre-wrap;
        }

        /* Key Metrics */
        .key-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }

        .metric-card {
            background: #F9FAFB;
            padding: 16px;
            border-radius: 8px;
            border: 1px solid var(--border);
        }

        .metric-label {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .metric-value {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
        }

        /* Tags */
        .tags {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 16px;
        }

        .tag {
            padding: 6px 12px;
            background: #FEF3C7;
            color: #D97706;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 80px 20px;
        }

        .loading-spinner {
            width: 48px;
            height: 48px;
            border: 4px solid #E5E7EB;
            border-top-color: var(--deep-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 15px;
            color: var(--text-secondary);
        }

        /* Not Found */
        .not-found {
            text-align: center;
            padding: 80px 20px;
        }

        .not-found-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }

        .not-found-text {
            font-size: 18px;
            color: var(--text-secondary);
            margin-bottom: 24px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 20px 16px;
            }

            .company-header,
            .report-section {
                padding: 24px 20px;
            }

            .company-title {
                font-size: 24px;
            }

            .company-meta {
                flex-direction: column;
                gap: 12px;
            }
        }
    </style>
</head>
<body>
    <!-- í—¤ë” -->
    <div id="header-container"></div>

    <div class="container">
        <!-- ë’¤ë¡œê°€ê¸° ë²„íŠ¼ -->
        <a href="link.html#companies" class="back-button">
            â† ê¸°ì—… ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°
        </a>

        <!-- ë¡œë”© ìƒíƒœ -->
        <div id="loadingState" class="loading">
            <div class="loading-spinner"></div>
            <p class="loading-text">í‰ê°€ë³´ê³ ì„œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>

        <!-- Not Found -->
        <div id="notFoundState" class="not-found" style="display: none;">
            <div class="not-found-icon">ğŸ“‹</div>
            <p class="not-found-text">í‰ê°€ë³´ê³ ì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
            <a href="link.html" class="back-button">ê¸°ì—… ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
        </div>

        <!-- ë³´ê³ ì„œ ë‚´ìš© -->
        <div id="reportContent" style="display: none;">
            <!-- ê¸°ì—… í—¤ë” -->
            <div class="company-header" id="companyHeader">
                <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
            </div>

            <!-- ìš”ì•½ -->
            <div class="report-section" id="executiveSummary">
                <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
            </div>

            <!-- í‰ê°€ ê°œìš” -->
            <div class="report-section" id="evaluationOverview">
                <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
            </div>

            <!-- í‰ê°€ ë°©ë²•ë¡  -->
            <div class="report-section" id="methodology">
                <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
            </div>

            <!-- í‰ê°€ ê²°ê³¼ -->
            <div class="report-section" id="valuationResults">
                <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
            </div>

            <!-- ê²°ë¡  -->
            <div class="report-section" id="conclusion">
                <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
            </div>
        </div>
    </div>

    <!-- í—¤ë” ë¡œë“œ -->
    <script>
        fetch('../components/header.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('header-container').innerHTML = data;
                const scripts = document.getElementById('header-container').querySelectorAll('script');
                scripts.forEach(script => {
                    const newScript = document.createElement('script');
                    if (script.src) {
                        newScript.src = script.src;
                    } else {
                        newScript.textContent = script.textContent;
                    }
                    document.body.appendChild(newScript);
                });
            })
            .catch(error => console.error('í—¤ë” ë¡œë“œ ì‹¤íŒ¨:', error));
    </script>

    <!-- í˜ì´ì§€ ìŠ¤í¬ë¦½íŠ¸ -->
    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';

        // Supabase í´ë¼ì´ì–¸íŠ¸
        const SUPABASE_URL = 'https://arxrfetgaitkgiiqabap.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFyeHJmZXRnYWl0a2dpaXFhYmFwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg3ODk1OTgsImV4cCI6MjA4NDM2NTU5OH0.BTnuv0sYr2MGe1c-gk8PWCviwkFyIiymfKp5Jhzwbo0';
        const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

        // í‰ê°€ë²• í•œê¸€ëª…
        const METHOD_NAMES = {
            dcf: 'DCFí‰ê°€ë²•',
            relative: 'ìƒëŒ€ê°€ì¹˜í‰ê°€ë²•',
            intrinsic: 'ë³¸ì§ˆê°€ì¹˜í‰ê°€ë²•',
            asset: 'ìì‚°ê°€ì¹˜í‰ê°€ë²•',
            inheritance_tax: 'ìƒì¦ì„¸ë²•í‰ê°€ë²•'
        };

        async function loadReport() {
            try {
                // URL íŒŒë¼ë¯¸í„°ì—ì„œ company_name ê°€ì ¸ì˜¤ê¸°
                const urlParams = new URLSearchParams(window.location.search);
                const companyName = urlParams.get('company');

                if (!companyName) {
                    showNotFound();
                    return;
                }

                // Supabaseì—ì„œ ë³´ê³ ì„œ ì¡°íšŒ
                const { data: report, error } = await supabase
                    .from('valuation_reports')
                    .select('*')
                    .eq('company_name', companyName)
                    .single();

                if (error || !report) {
                    console.error('ë³´ê³ ì„œ ì¡°íšŒ ì‹¤íŒ¨:', error);
                    showNotFound();
                    return;
                }

                // ë³´ê³ ì„œ í‘œì‹œ
                displayReport(report);

            } catch (error) {
                console.error('ì˜¤ë¥˜ ë°œìƒ:', error);
                showNotFound();
            }
        }

        function displayReport(report) {
            // ë¡œë”© ìˆ¨ê¹€
            document.getElementById('loadingState').style.display = 'none';
            document.getElementById('reportContent').style.display = 'block';

            // ê¸°ì—… í—¤ë”
            const companyHeader = document.getElementById('companyHeader');
            companyHeader.innerHTML = `
                <h1 class="company-title">${report.company_name}</h1>
                <div class="company-meta">
                    ${report.industry ? `
                    <div class="meta-item">
                        <span class="meta-label">ì—…ì¢…</span>
                        <span class="meta-value">${report.industry}</span>
                    </div>
                    ` : ''}
                    ${report.ceo_name ? `
                    <div class="meta-item">
                        <span class="meta-label">ëŒ€í‘œì</span>
                        <span class="meta-value">${report.ceo_name}</span>
                    </div>
                    ` : ''}
                    ${report.location ? `
                    <div class="meta-item">
                        <span class="meta-label">ì§€ì—­</span>
                        <span class="meta-value">${report.location}</span>
                    </div>
                    ` : ''}
                    <div class="meta-item">
                        <span class="meta-label">í‰ê°€ë°©ë²•</span>
                        <span class="meta-value">${METHOD_NAMES[report.valuation_method] || report.valuation_method}</span>
                    </div>
                    ${report.valuation_date ? `
                    <div class="meta-item">
                        <span class="meta-label">í‰ê°€ê¸°ì¤€ì¼</span>
                        <span class="meta-value">${report.valuation_date}</span>
                    </div>
                    ` : ''}
                </div>
                <div class="valuation-badge">
                    ğŸ’° ${report.valuation_amount_display || formatCurrency(report.valuation_amount_krw)}
                </div>
                ${report.tags && report.tags.length > 0 ? `
                <div class="tags">
                    ${report.tags.map(tag => `<span class="tag">#${tag}</span>`).join('')}
                </div>
                ` : ''}
                ${report.report_url ? `
                <a href="${report.report_url}" target="_blank" class="external-link">
                    ğŸ“„ ì›ë³¸ ê³µì‹œ ë³´ê¸° â†’
                </a>
                ` : ''}
            `;

            // ìš”ì•½
            if (report.executive_summary) {
                const summary = document.getElementById('executiveSummary');
                summary.innerHTML = `
                    <h2 class="section-title"><span class="section-title-icon">ğŸ“‹</span>ìš”ì•½</h2>
                    <div class="section-content">${report.executive_summary}</div>
                `;
            }

            // í‰ê°€ ê°œìš”
            if (report.evaluation_overview) {
                const overview = document.getElementById('evaluationOverview');
                overview.innerHTML = `
                    <h2 class="section-title"><span class="section-title-icon">ğŸ¯</span>í‰ê°€ ê°œìš”</h2>
                    <div class="section-content">${report.evaluation_overview}</div>
                `;
            }

            // í‰ê°€ ë°©ë²•ë¡ 
            if (report.methodology) {
                const methodology = document.getElementById('methodology');
                methodology.innerHTML = `
                    <h2 class="section-title"><span class="section-title-icon">ğŸ”¬</span>í‰ê°€ ë°©ë²•ë¡  ë° ê°€ì •</h2>
                    <div class="section-content">${report.methodology}</div>
                    ${report.key_metrics ? `
                    <div class="key-metrics">
                        ${Object.entries(report.key_metrics).map(([key, value]) => `
                            <div class="metric-card">
                                <div class="metric-label">${key}</div>
                                <div class="metric-value">${value}</div>
                            </div>
                        `).join('')}
                    </div>
                    ` : ''}
                `;
            }

            // í‰ê°€ ê²°ê³¼
            if (report.valuation_results) {
                const results = document.getElementById('valuationResults');
                results.innerHTML = `
                    <h2 class="section-title"><span class="section-title-icon">ğŸ’µ</span>í‰ê°€ ê²°ê³¼</h2>
                    <div class="section-content">${report.valuation_results}</div>
                `;
            }

            // ê²°ë¡ 
            if (report.conclusion) {
                const conclusion = document.getElementById('conclusion');
                conclusion.innerHTML = `
                    <h2 class="section-title"><span class="section-title-icon">âœ…</span>ê²°ë¡ </h2>
                    <div class="section-content">${report.conclusion}</div>
                `;
            }
        }

        function showNotFound() {
            document.getElementById('loadingState').style.display = 'none';
            document.getElementById('notFoundState').style.display = 'block';
        }

        function formatCurrency(amount) {
            if (!amount) return '-';
            return 'â‚©' + amount.toLocaleString('ko-KR');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
        loadReport();
    </script>
</body>
</html>
